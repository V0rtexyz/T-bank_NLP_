# üöÄ Telegram Monitor & Chunker Microservice

–ú–∏–∫—Ä–æ—Å–µ—Ä–≤–∏—Å –¥–ª—è –º–æ–Ω–∏—Ç–æ—Ä–∏–Ω–≥–∞ Telegram –∫–∞–Ω–∞–ª–æ–≤, —á–∞–Ω–∫–∏—Ä–æ–≤–∞–Ω–∏—è –ø–æ—Å—Ç–æ–≤ –∏ –æ—Ç–ø—Ä–∞–≤–∫–∏ –¥–∞–Ω–Ω—ã—Ö.

## üìÅ –°—Ç—Ä—É–∫—Ç—É—Ä–∞ –ø—Ä–æ–µ–∫—Ç–∞

```
T-bank_NLP_/
‚îú‚îÄ‚îÄ data/                           # –î–∞–Ω–Ω—ã–µ (—Å–æ–∑–¥–∞–µ—Ç—Å—è –∞–≤—Ç–æ–º–∞—Ç–∏—á–µ—Å–∫–∏)
‚îÇ   ‚îî‚îÄ‚îÄ telegram/
‚îÇ       ‚îú‚îÄ‚îÄ omyinvestments/
‚îÇ       ‚îÇ   ‚îú‚îÄ‚îÄ messages_monitor.json
‚îÇ       ‚îÇ   ‚îî‚îÄ‚îÄ messages_chunked.json
‚îÇ       ‚îî‚îÄ‚îÄ ...
‚îú‚îÄ‚îÄ src/
‚îÇ   ‚îî‚îÄ‚îÄ tplexity/
‚îÇ       ‚îî‚îÄ‚îÄ tg_parse/
‚îÇ           ‚îú‚îÄ‚îÄ app.py              # –ú–∏–∫—Ä–æ—Å–µ—Ä–≤–∏—Å
‚îÇ           ‚îú‚îÄ‚îÄ config.json         # –ö–æ–Ω—Ñ–∏–≥—É—Ä–∞—Ü–∏—è
‚îÇ           ‚îú‚îÄ‚îÄ monitor.py
‚îÇ           ‚îú‚îÄ‚îÄ telegram_downloader.py
‚îÇ           ‚îî‚îÄ‚îÄ chunker.py
‚îú‚îÄ‚îÄ my_session.session              # Telegram —Å–µ—Å—Å–∏—è
‚îú‚îÄ‚îÄ pyproject.toml                  # Poetry –∫–æ–Ω—Ñ–∏–≥—É—Ä–∞—Ü–∏—è
‚îú‚îÄ‚îÄ requirements.txt
‚îî‚îÄ‚îÄ start.bat                       # –ó–∞–ø—É—Å–∫ –º–∏–∫—Ä–æ—Å–µ—Ä–≤–∏—Å–∞
```

## üõ†Ô∏è –£—Å—Ç–∞–Ω–æ–≤–∫–∞

### 1. –£—Å—Ç–∞–Ω–æ–≤–∏—Ç–µ –∑–∞–≤–∏—Å–∏–º–æ—Å—Ç–∏

**–ß–µ—Ä–µ–∑ Poetry:**
```bash
poetry install
```

**–ß–µ—Ä–µ–∑ pip:**
```bash
pip install -r requirements.txt
```

### 2. –ù–∞—Å—Ç—Ä–æ–π—Ç–µ –∫–æ–Ω—Ñ–∏–≥—É—Ä–∞—Ü–∏—é

–û—Ç—Ä–µ–¥–∞–∫—Ç–∏—Ä—É–π—Ç–µ `src/tplexity/tg_parse/config.json`:

```json
{
  "channels": [
    "omyinvestments",
    "alfa_investments",
    "tb_invest_official",
    "SberInvestments",
    "centralbank_russia",
    "selfinvestor"
  ],
  "check_interval": 60,
  "webhook_url": "http://localhost:8001/api/receive_chunks",
  "api_id": YOUR_API_ID,
  "api_hash": "YOUR_API_HASH",
  "phone": "+YOUR_PHONE",
  "session_name": "my_session",
  "data_dir": "data"
}
```

**–ì–¥–µ –≤–∑—è—Ç—å API credentials:**
- –ó–∞–π–¥–∏—Ç–µ –Ω–∞ https://my.telegram.org
- Login —Å –≤–∞—à–∏–º –Ω–æ–º–µ—Ä–æ–º —Ç–µ–ª–µ—Ñ–æ–Ω–∞
- API development tools
- –°–æ–∑–¥–∞–π—Ç–µ –ø—Ä–∏–ª–æ–∂–µ–Ω–∏–µ –∏ –ø–æ–ª—É—á–∏—Ç–µ `api_id` –∏ `api_hash`

### 3. –°–æ–∑–¥–∞–π—Ç–µ Telegram —Å–µ—Å—Å–∏—é (–µ—Å–ª–∏ –µ—â–µ –Ω–µ—Ç)

–§–∞–π–ª `my_session.session` –¥–æ–ª–∂–µ–Ω –Ω–∞—Ö–æ–¥–∏—Ç—å—Å—è –≤ **–∫–æ—Ä–Ω–µ –ø—Ä–æ–µ–∫—Ç–∞**.

–ï—Å–ª–∏ –µ–≥–æ –Ω–µ—Ç, –ø—Ä–∏ –ø–µ—Ä–≤–æ–º –∑–∞–ø—É—Å–∫–µ Telegram –ø–æ–ø—Ä–æ—Å–∏—Ç –∞–≤—Ç–æ—Ä–∏–∑–∞—Ü–∏—é.

## üöÄ –ó–∞–ø—É—Å–∫

### –í–∞—Ä–∏–∞–Ω—Ç 1: –ß–µ—Ä–µ–∑ bat —Ñ–∞–π–ª (Windows)

```bash
start.bat
```

### –í–∞—Ä–∏–∞–Ω—Ç 2: –í—Ä—É—á–Ω—É—é

```bash
python -m uvicorn src.tplexity.tg_parse.app:app --host 0.0.0.0 --port 8000
```

### –í–∞—Ä–∏–∞–Ω—Ç 3: –ß–µ—Ä–µ–∑ Poetry

```bash
poetry run python -m uvicorn src.tplexity.tg_parse.app:app --host 0.0.0.0 --port 8000
```

## üì° –ò—Å–ø–æ–ª—å–∑–æ–≤–∞–Ω–∏–µ

### 1. –û—Ç–∫—Ä–æ–π—Ç–µ Swagger UI

```
http://localhost:8000/docs
```

### 2. –î–æ—Å—Ç—É–ø–Ω—ã–µ endpoints:

#### POST /start
–ó–∞–ø—É—Å–∫–∞–µ—Ç –º–æ–Ω–∏—Ç–æ—Ä–∏–Ω–≥:
- –ó–∞–≥—Ä—É–∂–∞–µ—Ç —Å—É—â–µ—Å—Ç–≤—É—é—â–∏–µ –ø–æ—Å—Ç—ã –∏–∑ `data/telegram/`
- –ß–∞–Ω–∫–∏—Ä—É–µ—Ç –∏—Ö
- –ó–∞–ø—É—Å–∫–∞–µ—Ç –∞—Å–∏–Ω—Ö—Ä–æ–Ω–Ω—ã–π –º–æ–Ω–∏—Ç–æ—Ä–∏–Ω–≥ (–ø—Ä–æ–≤–µ—Ä–∫–∞ –∫–∞–∂–¥—É—é –º–∏–Ω—É—Ç—É)

#### POST /stop
–û—Å—Ç–∞–Ω–∞–≤–ª–∏–≤–∞–µ—Ç –º–æ–Ω–∏—Ç–æ—Ä–∏–Ω–≥

#### GET /status
–ü–æ–∫–∞–∑—ã–≤–∞–µ—Ç —Ç–µ–∫—É—â–∏–π —Å—Ç–∞—Ç—É—Å —Å–µ—Ä–≤–∏—Å–∞

#### GET /health
Health check

### 3. –ü—Ä–∏–º–µ—Ä –∏—Å–ø–æ–ª—å–∑–æ–≤–∞–Ω–∏—è:

1. –û—Ç–∫—Ä–æ–π—Ç–µ http://localhost:8000/docs
2. –ù–∞–π–¥–∏—Ç–µ **POST /start**
3. –ù–∞–∂–º–∏—Ç–µ **Try it out**
4. –ù–∞–∂–º–∏—Ç–µ **Execute**

‚úÖ –ì–æ—Ç–æ–≤–æ! –ú–∏–∫—Ä–æ—Å–µ—Ä–≤–∏—Å –Ω–∞—á–Ω–µ—Ç —Ä–∞–±–æ—Ç–∞—Ç—å.

## üìä –ß—Ç–æ –ø—Ä–æ–∏—Å—Ö–æ–¥–∏—Ç

### –ü—Ä–∏ –∑–∞–ø—É—Å–∫–µ POST /start:

1. **–ó–∞–≥—Ä—É–∑–∫–∞ —Å—É—â–µ—Å—Ç–≤—É—é—â–∏—Ö –¥–∞–Ω–Ω—ã—Ö:**
   - –ß–∏—Ç–∞–µ—Ç `data/telegram/[–∫–∞–Ω–∞–ª]/messages_monitor.json`
   - –§–∏–ª—å—Ç—Ä—É–µ—Ç –ø–æ—Å—Ç—ã —Å –ø—É—Å—Ç—ã–º —Ç–µ–∫—Å—Ç–æ–º
   - –ß–∞–Ω–∫–∏—Ä—É–µ—Ç –ø–æ—Å—Ç—ã

2. **–°–æ—Ö—Ä–∞–Ω–µ–Ω–∏–µ —á–∞–Ω–∫–æ–≤:**
   - –°–æ–∑–¥–∞–µ—Ç `data/telegram/[–∫–∞–Ω–∞–ª]/messages_chunked.json`

3. **–ê—Å–∏–Ω—Ö—Ä–æ–Ω–Ω—ã–π –º–æ–Ω–∏—Ç–æ—Ä–∏–Ω–≥:**
   - –ö–∞–∂–¥—É—é –º–∏–Ω—É—Ç—É –ø—Ä–æ–≤–µ—Ä—è–µ—Ç –Ω–æ–≤—ã–µ –ø–æ—Å—Ç—ã –≤ Telegram
   - –ß–∞–Ω–∫–∏—Ä—É–µ—Ç –Ω–æ–≤—ã–µ –ø–æ—Å—Ç—ã
   - –î–æ–±–∞–≤–ª—è–µ—Ç –≤ JSON
   - –û—Ç–ø—Ä–∞–≤–ª—è–µ—Ç –Ω–∞ webhook (–µ—Å–ª–∏ –Ω–∞—Å—Ç—Ä–æ–µ–Ω)

## üîß –ù–∞—Å—Ç—Ä–æ–π–∫–∞ webhook

–ï—Å–ª–∏ —Ö–æ—Ç–∏—Ç–µ –ø–æ–ª—É—á–∞—Ç—å —á–∞–Ω–∫–∏ –≤ —Å–≤–æ–π —Å–µ—Ä–≤–∏—Å, –Ω–∞—Å—Ç—Ä–æ–π—Ç–µ `webhook_url` –≤ `config.json`:

```json
{
  "webhook_url": "http://your-service.com/api/receive"
}
```

–í–∞—à —Å–µ—Ä–≤–∏—Å –¥–æ–ª–∂–µ–Ω –ø—Ä–∏–Ω–∏–º–∞—Ç—å POST –∑–∞–ø—Ä–æ—Å—ã —Å JSON:

```json
{
  "chunks": [
    {
      "original_id": 12345,
      "original_link": "https://t.me/channel/12345",
      "original_date": "2025-11-14T10:00:00+00:00",
      "chunk_index": 0,
      "chunk_text": "–¢–µ–∫—Å—Ç —á–∞–Ω–∫–∞...",
      "chunk_length": 150,
      "views": 5000,
      "forwards": 10,
      "has_media": false,
      "media_type": null,
      "channel_name": "omyinvestments",
      "timestamp": "2025-11-14T10:01:00.123456"
    }
  ]
}
```

## üìù –õ–æ–≥–∏

–í —Ç–µ—Ä–º–∏–Ω–∞–ª–µ –≥–¥–µ –∑–∞–ø—É—â–µ–Ω –º–∏–∫—Ä–æ—Å–µ—Ä–≤–∏—Å –±—É–¥—É—Ç –ª–æ–≥–∏:

```
INFO - –ó–∞–ø—É—Å–∫ –º–∏–∫—Ä–æ—Å–µ—Ä–≤–∏—Å–∞...
INFO - –ó–∞–≥—Ä—É–∂–µ–Ω–∞ –∫–æ–Ω—Ñ–∏–≥—É—Ä–∞—Ü–∏—è: ['omyinvestments', ...]
INFO - –ò–Ω–∏—Ü–∏–∞–ª–∏–∑–∞—Ü–∏—è —Å–µ—Ä–≤–∏—Å–∞...
INFO - –ö–æ—Ä–µ–Ω—å –ø—Ä–æ–µ–∫—Ç–∞: C:\ITMO\...\T-bank_NLP_
INFO - –î–∏—Ä–µ–∫—Ç–æ—Ä–∏—è –¥–∞–Ω–Ω—ã—Ö: C:\ITMO\...\T-bank_NLP_\data
INFO - Telegram –∫–ª–∏–µ–Ω—Ç —É—Å–ø–µ—à–Ω–æ –ø–æ–¥–∫–ª—é—á–µ–Ω
INFO - –ö–∞–Ω–∞–ª omyinvestments: –Ω–∞–π–¥–µ–Ω–æ 99 –ø–æ—Å—Ç–æ–≤ (85 —Å —Ç–µ–∫—Å—Ç–æ–º)
INFO - –ö–∞–Ω–∞–ª omyinvestments: —Å–æ–∑–¥–∞–Ω–æ 198 —á–∞–Ω–∫–æ–≤
INFO - –ó–∞–ø—É—Å–∫ –º–æ–Ω–∏—Ç–æ—Ä–∏–Ω–≥–∞ –∫–∞–Ω–∞–ª–æ–≤...
```

## ‚öôÔ∏è –ü–∞—Ä–∞–º–µ—Ç—Ä—ã –∫–æ–Ω—Ñ–∏–≥—É—Ä–∞—Ü–∏–∏

| –ü–∞—Ä–∞–º–µ—Ç—Ä | –û–ø–∏—Å–∞–Ω–∏–µ | –ü–æ —É–º–æ–ª—á–∞–Ω–∏—é |
|----------|----------|--------------|
| `channels` | –°–ø–∏—Å–æ–∫ Telegram –∫–∞–Ω–∞–ª–æ–≤ –¥–ª—è –º–æ–Ω–∏—Ç–æ—Ä–∏–Ω–≥–∞ | - |
| `check_interval` | –ò–Ω—Ç–µ—Ä–≤–∞–ª –ø—Ä–æ–≤–µ—Ä–∫–∏ –Ω–æ–≤—ã—Ö —Å–æ–æ–±—â–µ–Ω–∏–π (—Å–µ–∫) | 60 |
| `webhook_url` | URL –¥–ª—è –æ—Ç–ø—Ä–∞–≤–∫–∏ —á–∞–Ω–∫–æ–≤ | null |
| `api_id` | Telegram API ID | - |
| `api_hash` | Telegram API Hash | - |
| `phone` | –ù–æ–º–µ—Ä —Ç–µ–ª–µ—Ñ–æ–Ω–∞ | - |
| `session_name` | –ò–º—è —Ñ–∞–π–ª–∞ —Å–µ—Å—Å–∏–∏ (–±–µ–∑ .session) | "my_session" |
| `data_dir` | –î–∏—Ä–µ–∫—Ç–æ—Ä–∏—è –¥–ª—è –¥–∞–Ω–Ω—ã—Ö | "data" |

## üîç –ß–∞–Ω–∫–∏—Ä–æ–≤–∞–Ω–∏–µ

–ò—Å–ø–æ–ª—å–∑—É–µ—Ç—Å—è **LangChain RecursiveCharacterTextSplitter** —Å –∏–µ—Ä–∞—Ä—Ö–∏–µ–π —Ä–∞–∑–¥–µ–ª–∏—Ç–µ–ª–µ–π:

1. `\n\nüîπ` - –æ—Å–Ω–æ–≤–Ω—ã–µ —Ä–∞–∑–¥–µ–ª–∏—Ç–µ–ª–∏ –Ω–æ–≤–æ—Å—Ç–µ–π
2. `\n\nüî∏` - –¥–æ–ø–æ–ª–Ω–∏—Ç–µ–ª—å–Ω—ã–µ —Ä–∞–∑–¥–µ–ª–∏—Ç–µ–ª–∏
3. `\n\n‚Ä¢` - –º–∞—Ä–∫–∏—Ä–æ–≤–∞–Ω–Ω—ã–µ —Å–ø–∏—Å–∫–∏
4. `\n\n` - –ø–∞—Ä–∞–≥—Ä–∞—Ñ—ã
5. `\n` - —Å—Ç—Ä–æ–∫–∏
6. ` ` - —Å–ª–æ–≤–∞

**–ü–∞—Ä–∞–º–µ—Ç—Ä—ã:**
- `chunk_size`: 1000 —Å–∏–º–≤–æ–ª–æ–≤
- `chunk_overlap`: 100 —Å–∏–º–≤–æ–ª–æ–≤
- –ú–∏–Ω–∏–º–∞–ª—å–Ω–∞—è –¥–ª–∏–Ω–∞ —á–∞–Ω–∫–∞: 50 —Å–∏–º–≤–æ–ª–æ–≤

## üõë –û—Å—Ç–∞–Ω–æ–≤–∫–∞

–í Swagger UI: **POST /stop**

–ò–ª–∏ –∑–∞–∫—Ä–æ–π—Ç–µ —Ç–µ—Ä–º–∏–Ω–∞–ª (Ctrl+C)

## üêõ Troubleshooting

### –û—à–∏–±–∫–∞: ModuleNotFoundError

```bash
pip install -r requirements.txt
```

### –û—à–∏–±–∫–∞: sqlite3.OperationalError

–ü—Ä–æ–≤–µ—Ä—å—Ç–µ —á—Ç–æ:
- –§–∞–π–ª `my_session.session` –Ω–∞—Ö–æ–¥–∏—Ç—Å—è –≤ **–∫–æ—Ä–Ω–µ –ø—Ä–æ–µ–∫—Ç–∞**
- –í `config.json` –ø–∞—Ä–∞–º–µ—Ç—Ä `session_name` = `"my_session"` (–±–µ–∑ .session)

### –û—à–∏–±–∫–∞: Telegram –∫–ª–∏–µ–Ω—Ç –Ω–µ –∞–≤—Ç–æ—Ä–∏–∑–æ–≤–∞–Ω

–ü—Ä–∏ –ø–µ—Ä–≤–æ–º –∑–∞–ø—É—Å–∫–µ Telegram –ø–æ–ø—Ä–æ—Å–∏—Ç –∫–æ–¥ –∞–≤—Ç–æ—Ä–∏–∑–∞—Ü–∏–∏. –ü—Ä–æ–≤–µ—Ä—å—Ç–µ –∫–æ–Ω—Å–æ–ª—å.

---

**–ì–æ—Ç–æ–≤–æ! –ú–∏–∫—Ä–æ—Å–µ—Ä–≤–∏—Å —Ä–∞–±–æ—Ç–∞–µ—Ç!** üéâ
